/**
 * Agent Prompt Generator (Webapp Display Version)
 *
 * Simplified version for UI display purposes only.
 * The authoritative prompts are generated by the backend.
 * This is kept for backward compatibility with UI components.
 */

import { getRoleTemplate } from './templates.js';
import { getCliEnvPrefix } from '../utils/env.js';

export interface PromptContext {
  chatroomId: string;
  role: string;
  teamName: string;
  teamRoles: string[];
  teamEntryPoint?: string;
  /** The Convex URL being used. If non-production, CLI commands will include env var override. */
  convexUrl?: string;
}

/**
 * Generate a simplified agent initialization prompt for UI display
 * Note: This is a simplified version. The CLI fetches the full prompt from the backend.
 */
export function generateAgentPrompt(context: PromptContext): string {
  const { chatroomId, role, teamName, teamRoles, convexUrl } = context;
  const template = getRoleTemplate(role);
  const cliEnvPrefix = getCliEnvPrefix(convexUrl);

  return `# ${teamName} Team

## Your Role: ${template.title.toUpperCase()}

${template.description}

**Responsibilities:**
${template.responsibilities.map((r) => `- ${r}`).join('\n')}

## Getting Started

### Step 1: Gain Context

Before waiting for tasks, understand the conversation history:

\`\`\`bash
${cliEnvPrefix}chatroom context read ${chatroomId} --role=${role}
\`\`\`

This shows:
- Origin message and classification
- Full conversation history
- Pending tasks for your role
- Current work status

### Step 2: Wait for Tasks

After gaining context, run:

\`\`\`bash
${cliEnvPrefix}chatroom wait-for-task ${chatroomId} --role=${role}
\`\`\`

The CLI will provide:
- Detailed workflow instructions
- Command examples
- Role-specific guidance
- Team collaboration patterns

## Team Roles

${teamRoles.join(', ')}

## Next Steps

1. Copy the **context read** command above
2. Review the conversation history
3. Run **wait-for-task** to receive your first task
4. Follow the detailed instructions provided by the CLI
`;
}

/**
 * Generate a short prompt for display in limited space
 */
export function generateShortPrompt(context: PromptContext): string {
  const { chatroomId, role, convexUrl } = context;
  const prefix = getCliEnvPrefix(convexUrl);
  return `${prefix}chatroom context read ${chatroomId} --role=${role} && ${prefix}chatroom wait-for-task ${chatroomId} --role=${role}`;
}
